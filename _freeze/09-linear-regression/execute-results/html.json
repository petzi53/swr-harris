{
  "hash": "b438eb8b2dffc2aa29925bdb0aafa8f7",
  "result": {
    "engine": "knitr",
    "markdown": "# Linear regression {#sec-chap09}\n\n\n\n\n\n::: {.callout-note}\nAs I have already read some books on linear regression I will not follow exactly the text in this chapter. I will leave out those passages that are not new for me and where I feel confident. Other passages I will only summarize to have content to consult whenever I would need it.\n:::\n\n\n\n\n\n## Achievements to unlock\n\n::: my-objectives\n::: my-objectives-header\nObjectives\n:::\n\n::: my-objectives-container\n**SwR Achievements**\n\n- **Achievement 1**: Using exploratory data analysis to learn about the data before developing a linear regression model (@sec-chap09-achievement1)\n- **Achievement 2**: Exploring the statistical model for a line (@sec-chap09-achievement2)\n- **Achievement 3**: Computing the slope and intercept in a simple linear regression (@sec-chap09-achievement3)\n- **Achievement 4**: Slope interpretation and significance ($b_{1}$, p-value, CI) (@sec-chap09-achievement4)\n- **Achievement 5**: Model significance and model fit (@sec-chap09-achievement5)\n- **Achievement 6**: Checking assumptions and conducting diagnostics (@sec-chap09-achievement6)\n- **Achievement 7**: Adding variables to the model and using transformation (@sec-chap09-achievement7)\n\n:::\n:::\n\n\n## The needle exchange examination\n\nSome infectious diseases like HIV and Hepatitis C are on the rise again with young people in non-urban areas having the highest increases and needle-sharing being a major factor. Clean needles are distributed by syringe services programs (SSPs), which can also provide a number of other related services including overdose prevention, referrals for substance use treatment, and infectious disease testing. But even there are programs in place --- which is not allowed legally in some US states! --- some people have to travel long distances for health services, especially for services that are specialized, such as needle exchanges.\n\nIn discussing the possible quenstion one could analyse it turned out that for some questions critical data are missing: \n\n- There is a distance-to-syringe-services-program variable among the health services data sources of <a class='glossary' title='amfAR, the Foundation for AIDS Research, known until 2005 as the American Foundation for AIDS Research, is an international nonprofit organization dedicated to the support of AIDS research, HIV prevention, treatment education, and the advocacy of AIDS-related public policy. (Wikipedia)'>amfAR</a> (https://opioid.amfar.org/). \n- Many of the interesting variables were not available for much of the nation, and many of them were only at the state level.\n\nGiven these limitations, the book focuses whether the distance to a syringe program could be explained by \n\n- whether a county is urban or rural, \n- what percentage of the county residents have insurance (as a measure of both access to health care and socioeconomic status [SES]), \n- HIV prevalence, \n- and the number of people with opioid prescriptions.\n\nAs there is no variable for rural or urban status in the amfAR database, the book will tale a variable from the U.S. Department of Agriculture Economic Research Services website (https://www.ers.usda.gov/data-products/county-typology-codes/) that classifies all counties as metro or non-metro.\n\n## Resources & Chapter Outline\n\n### Data, codebook, and R packages {#sec-chap04-data-codebook-packages}\n\n::: my-resource\n::: my-resource-header\nData, codebook, and R packages for learning about descriptive statistics\n:::\n\n::: my-resource-container\n\n**Data**\n\nTwo options for accessing the data:\n\n1. Download the clean data set `dist_ssp_amfar_ch9.csv` from https://edge.sagepub.com/harris1e.\n2. Follow the instructions in Box 9.1 to import, merge, and clean the data from multiple files or from the original online source \n\n\n\n**Codebook**\n\nTwo options for accessing the codebook: \n\n1. Download the codebook file `opioid_county_codebook.xlsx` from https://edge.sagepub.com/harris1e.\n2. Use the online codebook from the amfAR Opioid & Health Indicators Database website (https://opioid.amfar.org/)\n\n\n**Packages**\n\n1. Packages used with the book (sorted alphabetically)\n\n-   {**tidyverse**}: @pak-tidyverse (Hadley Wickham)\n-   {**tableone**}: @pak-tableone (Kazuki Yoshida) \n-   {**lmtest**}: @pak-lmtest (Achim Zeileis) \n-   {**broom**}, @pak-broom (David Robinson and Alex Hayes)\n-   {**car**}, @pak-car (John Fox)\n\n    \n2. My additional packages (sorted alphabetically)\n\n- {**gt**}: @pak-gt (Richard Iannone)\n- {**gtsummary**}: @pak-gtsummary (Daniel D. Sjoberg)\n\n:::\n:::\n\n\n### Get, recode and show data\n\nI will use the data file provided by the book because I am feeling quite confident with reading and recoding the original data. But I will change the columns names so that the variable names conform to the [tidyverse style guide](https://style.tidyverse.org/).\n\n:::::{.my-example}\n:::{.my-example-header}\n:::::: {#exm-chap09-data}\n: Data for chapter 9\n::::::\n:::\n::::{.my-example-container}\n\n::: {.panel-tabset}\n\n###### Get & recode\n\n:::::{.my-r-code}\n:::{.my-r-code-header}\n:::::: {#cnj-chap09-get-recode-data}\n: Get & recode data for chapter 9\n::::::\n:::\n::::{.my-r-code-container}\n\n::: {.cell}\n\n```{.r .cell-code}\n## run only once (manually)\ndistance_ssp <- readr::read_csv(\n    \"data/chap09/dist_ssp_amfar_ch9.csv\",\n    show_col_types = FALSE)\n\ndistance_ssp_clean <- distance_ssp |> \n    dplyr::rename(\n        state = \"STATEABBREVIATION\",\n        dist_ssp = \"dist_SSP\",\n        hiv_prevalence = \"HIVprevalence\",\n        opioid_rate = \"opioid_RxRate\",\n        no_insurance = \"pctunins\"\n    ) |> \n    dplyr::mutate(\n        state = forcats::as_factor(state),\n        metro = forcats::as_factor(metro)\n    ) |> \n    dplyr::mutate(\n        hiv_prevalence = dplyr::na_if(\n            x = hiv_prevalence,\n            y = -1\n        )\n    )\n\nsave_data_file(\"chap09\", distance_ssp_clean, \"distance_ssp_clean.rds\")\n```\n:::\n\n\n(*For this R code chunk is no output available*)\n\n::::\n:::::\n\n\n###### Show data\n\n:::::{.my-r-code}\n:::{.my-r-code-header}\n:::::: {#cnj-chap09-show-data}\n: Show data for chapter 9\n::::::\n:::\n::::{.my-r-code-container}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndistance_ssp_clean <- base::readRDS(\"data/chap09/distance_ssp_clean.rds\")\n\nskimr::skim(distance_ssp_clean)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |                   |\n|:------------------------|:------------------|\n|Name                     |distance_ssp_clean |\n|Number of rows           |500                |\n|Number of columns        |7                  |\n|_______________________  |                   |\n|Column type frequency:   |                   |\n|character                |1                  |\n|factor                   |2                  |\n|numeric                  |4                  |\n|________________________ |                   |\n|Group variables          |None               |\n\n\n**Variable type: character**\n\n|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|county        |         0|             1|  10|  28|     0|      406|          0|\n\n\n**Variable type: factor**\n\n|skim_variable | n_missing| complete_rate|ordered | n_unique|top_counts                     |\n|:-------------|---------:|-------------:|:-------|--------:|:------------------------------|\n|state         |         0|             1|FALSE   |       49|TX: 50, GA: 30, NC: 21, TN: 21 |\n|metro         |         0|             1|FALSE   |        2|non: 274, met: 226             |\n\n\n**Variable type: numeric**\n\n|skim_variable  | n_missing| complete_rate|   mean|     sd|   p0|   p25|    p50|    p75|   p100|hist  |\n|:--------------|---------:|-------------:|------:|------:|----:|-----:|------:|------:|------:|:-----|\n|dist_ssp       |         0|          1.00| 107.74|  94.23|  0.0| 35.12|  75.94| 163.83|  510.0|▇▃▂▁▁ |\n|hiv_prevalence |        70|          0.86| 192.89| 213.35| 14.4| 72.30| 118.95| 227.48| 2150.7|▇▁▁▁▁ |\n|opioid_rate    |         0|          1.00|  68.33|  36.81|  0.2| 45.12|  62.40|  89.95|  345.1|▇▆▁▁▁ |\n|no_insurance   |         0|          1.00|  12.18|   4.97|  3.0|  8.60|  11.70|  15.00|   35.9|▅▇▂▁▁ |\n\n\n:::\n:::\n\n\n::::\n:::::\n\n- **county**: the county name \n- **state**: the two-letter abbreviation for the state the county is in \n- **dist_ssp**: distance in miles to the nearest syringe services program \n- **hiv_prevalence**: people age 13 and older living with diagnosed HIV per 100,000\n- **opioid_rate**: number of opioid prescriptions per 100 people \n- **no_insurance**:percentage of the civilian non-institutionalized population with no health insurance coverage \n- **metro**: county is either nonmetro, which includes open countryside, rural towns, or smaller cities with up to 49,999 people, or metro\n\n\n\n:::\n\n::::\n:::::\n\n\n## Achievement 1: Explorative Data Analysis {#sec-chap09-achievement1}\n\nInstead following linearly the chapter I will try to compute my own <a class='glossary' title='Explorative Data Analysis is an approach of analyzing data sets to summarize their main characteristics, often using statistical graphics and other data visualization methods. A statistical model can be used or not, but primarily EDA is for seeing what the data can tell us beyond the formal modeling and thereby contrasts traditional hypothesis testing. (Wikipedia)'>EDA</a>.\n\n:::::{.my-example}\n:::{.my-example-header}\n:::::: {#exm-chap09-eda}\n: Explorative Data Analysis for chapter 9\n::::::\n:::\n::::{.my-example-container}\n\n::: {.panel-tabset}\n\n###### Histograms\n\n:::::{.my-r-code}\n:::{.my-r-code-header}\n:::::: {#cnj-chap09-eda-histograms}\n: Histograms of numeric variables\n::::::\n:::\n::::{.my-r-code-container}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist_distance <- my_hist_dnorm(\n    df = distance_ssp_clean,\n    v = distance_ssp_clean$dist_ssp,\n    n_bins = 30,\n    x_label = \"Nearest syringe services program in miles\"\n) \n\nhist_hiv <- my_hist_dnorm(\n    df = distance_ssp_clean,\n    v = distance_ssp_clean$hiv_prevalence,\n    n_bins = 30,\n    x_label = \"People with diagnosed HIV per 100,000\"\n) \n\nhist_opioid <- my_hist_dnorm(\n    df = distance_ssp_clean,\n    v = distance_ssp_clean$opioid_rate,\n    n_bins = 30,\n    x_label = \"Opioid prescriptions per 100 people\"\n)\n\nhist_insurance <- my_hist_dnorm(\n    df = distance_ssp_clean,\n    v = distance_ssp_clean$no_insurance,\n    n_bins = 30,\n    x_label = \"Percentage with no health insurance coverage\"\n)\n\ngridExtra::grid.arrange(\n   hist_distance, hist_hiv, hist_opioid, hist_insurance, nrow = 2\n)\n```\n\n::: {.cell-output-display}\n![Histograms for numeric variables of chapter 9](09-linear-regression_files/figure-html/fig-eda-histograms-1.png){#fig-eda-histograms width=672}\n:::\n:::\n\n\n::::\n:::::\n\n\n###### Q-Q plots\n\n:::::{.my-r-code}\n:::{.my-r-code-header}\n:::::: {#cnj-chap09-eda-qq-plots}\n: Q-Q plots of numeric variables\n::::::\n:::\n::::{.my-r-code-container}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqq_distance <- my_qq_plot(\n    df = distance_ssp_clean,\n    v  = distance_ssp_clean$dist_ssp,\n    col_qq = \"Distance to SSP\"\n)\n\nqq_hiv <- my_qq_plot(\n    df = distance_ssp_clean,\n    v  = distance_ssp_clean$hiv_prevalence,\n    col_qq = \"HIV diagnosed\"\n)\n\nqq_opioid <- my_qq_plot(\n    df = distance_ssp_clean,\n    v  = distance_ssp_clean$opioid_rate,\n    col_qq = \"Opioid prescriptions\"\n)\n\nqq_insurance <- my_qq_plot(\n    df = distance_ssp_clean,\n    v  = distance_ssp_clean$no_insurance,\n    col_qq = \"Health insurance\"\n)\n\n\ngridExtra::grid.arrange(\n   qq_distance, qq_hiv, qq_opioid, qq_insurance, nrow = 2\n)\n```\n\n::: {.cell-output-display}\n![Q-Q plots for numeric variables of chapter 9](09-linear-regression_files/figure-html/fig-eda-qq-plots-1.png){#fig-eda-qq-plots width=672}\n:::\n:::\n\n\n::::\n:::::\n\n###### Scatterplots\n\n:::::{.my-r-code}\n:::{.my-r-code-header}\n:::::: {#cnj-chap09-eda-scatterplots}\n: Scatterplots of numeric variables\n::::::\n:::\n::::{.my-r-code-container}\n\n::: {.cell}\n\n```{.r .cell-code}\nscatter_dist_hiv <-  my_scatter(\n    df = distance_ssp_clean,\n    v =  distance_ssp_clean$hiv_prevalence,\n    w =  distance_ssp_clean$dist_ssp,\n    x_label = \"HIV prevalence\",\n    y_label = \"Distance to SSP\"\n)\n\nscatter_dist_opioid <-  my_scatter(\n    df = distance_ssp_clean,\n    v =  distance_ssp_clean$opioid_rate,\n    w =  distance_ssp_clean$dist_ssp,\n    x_label = \"Opioid rate\",\n    y_label = \"Distance to SSP\"\n)\n\nscatter_dist_insurance <-  my_scatter(\n    df = distance_ssp_clean,\n    v =  distance_ssp_clean$no_insurance,\n    w =  distance_ssp_clean$dist_ssp,\n    x_label = \"No insurance\",\n    y_label = \"Distance to SSP\"\n)\n\ngridExtra::grid.arrange(\n   scatter_dist_hiv, scatter_dist_opioid, scatter_dist_insurance, nrow = 3\n)\n```\n\n::: {.cell-output-display}\n![Scatterplots of numeric variables](09-linear-regression_files/figure-html/fig-eda-scatterplots-1.png){#fig-eda-scatterplots width=672}\n:::\n:::\n\n\n::::\n:::::\n\n\n:::\n\n::::\n:::::\n\n***\n\n***\n\n## Exercises (empty)\n\n## Glossary\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:left;\"> definition </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> amfAR </td>\n   <td style=\"text-align:left;\"> amfAR, the Foundation for AIDS Research, known until 2005 as the American Foundation for AIDS Research, is an international nonprofit organization dedicated to the support of AIDS research, HIV prevention, treatment education, and the advocacy of AIDS-related public policy. (&lt;a href=\"https://en.wikipedia.org/wiki/AmfAR\"&gt;Wikipedia&lt;/a&gt;) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ExDA </td>\n   <td style=\"text-align:left;\"> Explorative Data Analysis is an approach of analyzing data sets to summarize their main characteristics, often using statistical graphics and other data visualization methods. A statistical model can be used or not, but primarily EDA is for seeing what the data can tell us beyond the formal modeling and thereby contrasts traditional hypothesis testing. (&lt;a href=\"https://en.wikipedia.org/wiki/Exploratory_data_analysis\"&gt;Wikipedia&lt;/a&gt;) </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n------------------------------------------------------------------------\n\n\n## Session Info {.unnumbered}\n\n:::::{.my-r-code}\n:::{.my-r-code-header}\nSession Info\n:::\n::::{.my-r-code-container}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessioninfo::session_info()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n#> ─ Session info ───────────────────────────────────────────────────────────────\n#>  setting  value\n#>  version  R version 4.3.3 (2024-02-29)\n#>  os       macOS Sonoma 14.4.1\n#>  system   x86_64, darwin20\n#>  ui       X11\n#>  language (EN)\n#>  collate  en_US.UTF-8\n#>  ctype    en_US.UTF-8\n#>  tz       Europe/Vienna\n#>  date     2024-04-07\n#>  pandoc   3.1.12.3 @ /usr/local/bin/ (via rmarkdown)\n#> \n#> ─ Packages ───────────────────────────────────────────────────────────────────\n#>  package     * version    date (UTC) lib source\n#>  base64enc     0.1-3      2015-07-28 [1] CRAN (R 4.3.0)\n#>  cli           3.6.2      2023-12-11 [1] CRAN (R 4.3.0)\n#>  colorspace    2.1-1      2024-01-03 [1] R-Forge (R 4.3.2)\n#>  commonmark    1.9.1      2024-01-30 [1] CRAN (R 4.3.2)\n#>  curl          5.2.1      2024-03-01 [1] CRAN (R 4.3.2)\n#>  digest        0.6.35     2024-03-11 [1] CRAN (R 4.3.2)\n#>  dplyr         1.1.4      2023-11-17 [1] CRAN (R 4.3.0)\n#>  evaluate      0.23       2023-11-01 [1] CRAN (R 4.3.0)\n#>  fansi         1.0.6      2023-12-08 [1] CRAN (R 4.3.0)\n#>  farver        2.1.1      2022-07-06 [1] CRAN (R 4.3.0)\n#>  fastmap       1.1.1      2023-02-24 [1] CRAN (R 4.3.0)\n#>  generics      0.1.3      2022-07-05 [1] CRAN (R 4.3.0)\n#>  ggplot2       3.5.0      2024-02-23 [1] CRAN (R 4.3.2)\n#>  glossary    * 1.0.0.9000 2023-08-12 [1] Github (debruine/glossary@819e329)\n#>  glue          1.7.0      2024-01-09 [1] CRAN (R 4.3.0)\n#>  gridExtra     2.3        2017-09-09 [1] CRAN (R 4.3.0)\n#>  gtable        0.3.4      2023-08-21 [1] CRAN (R 4.3.0)\n#>  highr         0.10       2022-12-22 [1] CRAN (R 4.3.0)\n#>  htmltools     0.5.8      2024-03-25 [1] CRAN (R 4.3.2)\n#>  htmlwidgets   1.6.4      2023-12-06 [1] CRAN (R 4.3.0)\n#>  jsonlite      1.8.8      2023-12-04 [1] CRAN (R 4.3.0)\n#>  kableExtra    1.4.0      2024-01-24 [1] CRAN (R 4.3.2)\n#>  knitr         1.45       2023-10-30 [1] CRAN (R 4.3.0)\n#>  labeling      0.4.3      2023-08-29 [1] CRAN (R 4.3.0)\n#>  lattice       0.22-6     2024-03-20 [2] CRAN (R 4.3.2)\n#>  lifecycle     1.0.4      2023-11-07 [1] CRAN (R 4.3.0)\n#>  magrittr      2.0.3      2022-03-30 [1] CRAN (R 4.3.0)\n#>  markdown      1.12       2023-12-06 [1] CRAN (R 4.3.0)\n#>  Matrix        1.6-5      2024-01-11 [1] CRAN (R 4.3.0)\n#>  mgcv          1.9-1      2023-12-21 [1] CRAN (R 4.3.0)\n#>  munsell       0.5.0      2018-06-12 [1] CRAN (R 4.3.0)\n#>  nlme          3.1-164    2023-11-27 [1] CRAN (R 4.3.2)\n#>  pillar        1.9.0      2023-03-22 [1] CRAN (R 4.3.0)\n#>  pkgconfig     2.0.3      2019-09-22 [1] CRAN (R 4.3.0)\n#>  purrr         1.0.2      2023-08-10 [1] CRAN (R 4.3.0)\n#>  R6            2.5.1      2021-08-19 [1] CRAN (R 4.3.0)\n#>  repr          1.1.7      2024-03-22 [1] CRAN (R 4.3.3)\n#>  rlang         1.1.3      2024-01-10 [1] CRAN (R 4.3.0)\n#>  rmarkdown     2.26       2024-03-05 [1] CRAN (R 4.3.2)\n#>  rstudioapi    0.16.0     2024-03-24 [1] CRAN (R 4.3.2)\n#>  rversions     2.1.2      2022-08-31 [1] CRAN (R 4.3.0)\n#>  scales        1.3.0      2023-11-28 [1] CRAN (R 4.3.2)\n#>  sessioninfo   1.2.2      2021-12-06 [1] CRAN (R 4.3.0)\n#>  skimr         2.1.5      2022-12-23 [1] CRAN (R 4.3.0)\n#>  stringi       1.8.3      2023-12-11 [1] CRAN (R 4.3.0)\n#>  stringr       1.5.1      2023-11-14 [1] CRAN (R 4.3.0)\n#>  svglite       2.1.3      2023-12-08 [1] CRAN (R 4.3.0)\n#>  systemfonts   1.0.6      2024-03-07 [1] CRAN (R 4.3.2)\n#>  tibble        3.2.1      2023-03-20 [1] CRAN (R 4.3.0)\n#>  tidyr         1.3.1      2024-01-24 [1] CRAN (R 4.3.2)\n#>  tidyselect    1.2.1      2024-03-11 [1] CRAN (R 4.3.2)\n#>  utf8          1.2.4      2023-10-22 [1] CRAN (R 4.3.0)\n#>  vctrs         0.6.5      2023-12-01 [1] CRAN (R 4.3.2)\n#>  viridisLite   0.4.2      2023-05-02 [1] CRAN (R 4.3.0)\n#>  withr         3.0.0      2024-01-16 [1] CRAN (R 4.3.0)\n#>  xfun          0.43       2024-03-25 [1] CRAN (R 4.3.2)\n#>  xml2          1.3.6      2023-12-04 [1] CRAN (R 4.3.0)\n#>  yaml          2.3.8      2023-12-11 [1] CRAN (R 4.3.0)\n#> \n#>  [1] /Library/Frameworks/R.framework/Versions/4.3-x86_64/library\n#>  [2] /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/library\n#> \n#> ──────────────────────────────────────────────────────────────────────────────\n```\n\n\n:::\n:::\n\n\n\n::::\n:::::\n",
    "supporting": [
      "09-linear-regression_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}